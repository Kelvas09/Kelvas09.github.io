<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Convert a closure or a delegate to async / await &#183; Kelvas blog</title><meta name=title content="Convert a closure or a delegate to async / await &#183; Kelvas blog"><meta name=description content="Thinks twice, code once"><link rel=canonical href=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/><link type=text/css rel=stylesheet href=/blog/css/main.bundle.min.564bd42a5e26b676657968da510e1b5dc2e901c82ae40e09a52f34b39ed1bf23f65778b05cb2d87a4affbbc5296a3cfd0d2f6131469ff95409422e12b6bccfb4.css integrity="sha512-VkvUKl4mtnZleWjaUQ4bXcLpAcgq5A4JpS80s57RvyP2V3iwXLLYekr/u8Upajz9DS9hMUaf+VQJQi4StrzPtA=="><script type=text/javascript src=/blog/js/appearance.min.9f339e83dd90dc94251893129cfc85cc479aaa0f9fba8f785b7fc36119fa50653fec43bcfb790b8e74d0d7586313dc5d4a606d5db8c8ed7a6ac444fa905e3439.js integrity="sha512-nzOeg92Q3JQlGJMSnPyFzEeaqg+fuo94W3/DYRn6UGU/7EO8+3kLjnTQ11hjE9xdSmBtXbjI7XpqxET6kF40OQ=="></script>
<script defer type=text/javascript id=script-bundle src=/blog/js/main.bundle.min.834d6b4d9147f0358db730e32000d6cfe107f549babe2a7c97cac37b88630d9bd03f55e5606dfa6295d68bbda40afe6c5be61df52bff647b406a8b716ad0ae95.js integrity="sha512-g01rTZFH8DWNtzDjIADWz+EH9Um6vip8l8rDe4hjDZvQP1XlYG36YpXWi72kCv5sW+Yd9Sv/ZHtAaotxatCulQ==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=manifest href=/blog/site.webmanifest><meta property="og:title" content="Convert a closure or a delegate to async / await"><meta property="og:description" content="With Swift 5.5 and the SE-0296 it is now possible to use async / await as in many languages such as C#, Typescript, Javascript or even Rust.
Until now we handled asynchronism in three different ways: the delegated as Apple does a lot, closures (also called completionHandler) as many do or with RxSwift or other libraries like Promise.
But with the arrival of async / await it is no longer necessary to go through all that."><meta property="og:type" content="article"><meta property="og:url" content="https://kelvas09.github.io/blog/posts/closure-delegate-to-async/"><meta property="og:image" content="https://kelvas09.github.io/blog/banners/convert_closure_async.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-21T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kelvas09.github.io/blog/banners/convert_closure_async.png"><meta name=twitter:title content="Convert a closure or a delegate to async / await"><meta name=twitter:description content="With Swift 5.5 and the SE-0296 it is now possible to use async / await as in many languages such as C#, Typescript, Javascript or even Rust.
Until now we handled asynchronism in three different ways: the delegated as Apple does a lot, closures (also called completionHandler) as many do or with RxSwift or other libraries like Promise.
But with the arrival of async / await it is no longer necessary to go through all that."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Convert a closure or a delegate to async \/ await","headline":"Convert a closure or a delegate to async \/ await","abstract":"With Swift 5.5 and the SE-0296 it is now possible to use async \/ await as in many languages such as C#, Typescript, Javascript or even Rust.\nUntil now we handled asynchronism in three different ways: the delegated as Apple does a lot, closures (also called completionHandler) as many do or with RxSwift or other libraries like Promise.\nBut with the arrival of async \/ await it is no longer necessary to go through all that.","inLanguage":"en","url":"https:\/\/kelvas09.github.io\/blog\/posts\/closure-delegate-to-async\/","author":{"@type":"Person","name":"Kévin Sibué (as Kelvas)"},"copyrightYear":"2022","dateCreated":"2022-09-21T00:00:00\u002b00:00","datePublished":"2022-09-21T00:00:00\u002b00:00","dateModified":"2022-09-21T00:00:00\u002b00:00","keywords":["swift"],"mainEntityOfPage":"true","wordCount":"1331"}]</script><meta name=generator content="Hugo 0.119.0"><meta name=author content="Kévin Sibué (as Kelvas)"><link href=mailto:kevin.sibue.pro@outlook.com rel=me><link href=https://bento.me/kevin-sibue rel=me><link href=https://github.com/Kelvas09 rel=me><link href=https://linkedin.com/in/kevin-sibue-a67417b8 rel=me><link href=https://home.social/@kelvas rel=me><link href=https://www.reddit.com/user/KevSib rel=me><link href=https://twitter.com/KevinSibue rel=me><script defer type=text/javascript src=/blog/js/mermaid.bundle.2daab5322e59118ff2170664acfa53a075b6601b0a9ab9de487fc689e911b60a92e416041bc00acc6fdd8e51d702765a295068de4bd6bba9ec035ee454202271.js integrity="sha512-Laq1Mi5ZEY/yFwZkrPpToHW2YBsKmrneSH/GiekRtgqS5BYEG8AKzG/djlHXAnZaKVBo3kvWu6nsA17kVCAicQ=="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7VP0YEPWLP"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7VP0YEPWLP",{anonymize_ip:!1})}</script><script type=text/javascript>(function(e,t){if(!t.__SV){var n,s,o,i;window.mixpanel=t,t._i=[],t.init=function(e,n,o){function c(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var r,a=t;"undefined"!=typeof o?a=t[o]=[]:o="mixpanel",a.people=a.people||[],a.toString=function(e){var t="mixpanel";return"mixpanel"!==o&&(t+="."+o),e||(t+=" (stub)"),t},a.people.toString=function(){return a.toString(1)+".people (stub)"},i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(s=0;s<i.length;s++)c(a,i[s]);r="set set_once union unset remove delete".split(" "),a.get_group=function(){function n(e){t[e]=function(){call2_args=arguments,call2=[e].concat(Array.prototype.slice.call(call2_args,0)),a.push([s,call2])}}for(var t={},s=["get_group"].concat(Array.prototype.slice.call(arguments,0)),e=0;e<r.length;e++)n(r[e]);return t},t._i.push([e,n,o])},t.__SV=1.2,n=e.createElement("script"),n.type="text/javascript",n.async=!0,n.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",o=e.getElementsByTagName("script")[0],o.parentNode.insertBefore(n,o)}})(document,window.mixpanel||[]),mixpanel.init("ba597a07cbf4e5f6eddb3de9d31b87bd",{debug:!0}),mixpanel.track("Display page",{title:document.title})</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-7VP0YEPWLP","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Kelvas blog</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/posts/ title=Posts>Blog</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/categories/ title=Categories>Categories</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/tags/ title=Tags>Tags</a></li><li class="ltr:text-right rtl:text-left ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><main id=main-content class="relative grow"><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/blog/>Kelvas blog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/blog/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/blog/posts/closure-delegate-to-async/>Convert a closure or a delegate to async / await</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Convert a closure or a delegate to async / await</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-09-21 00:00:00 +0000 UTC">21 September 2022</time><span class="px-2 text-primary-500">&#183;</span><span>1331 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/blog/categories/ios/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">iOS</a>
<a href=/blog/categories/macos/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">macOS</a>
<a href=/blog/tags/swift/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">swift</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-functioning-of-a-delegate>The functioning of a delegate</a></li><li><a href=#the-case-of-closures>The case of closures</a></li><li><a href=#the-tools-provided-by-apple>The tools provided by Apple</a></li><li><a href=#proof-by-example>Proof by example</a><ul><li><a href=#with-a-closure>With a closure</a></li><li><a href=#with-a-delegate>With a delegate</a></li></ul></li><li><a href=#sources>Sources</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><p>With Swift 5.5 and the <a href=https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md>SE-0296</a> it is now possible to use <mark>async / await</mark> as in many languages such as <mark>C#</mark>, <mark>Typescript</mark>, <mark>Javascript</mark> or even <mark>Rust</mark>.</p><p>Until now we handled asynchronism in three different ways: the <mark>delegated</mark> as Apple does a lot, closures (also called completionHandler) as many do or with <mark>RxSwift</mark> or other libraries like <mark>Promise</mark>.</p><p>But with the arrival of async / await it is no longer necessary to go through all that. So how to convert existing code, especially libraries, to async / await without rewriting everything?</p><p>In this article we will see together how to convert <mark>delegate</mark> and <mark>closure</mark> to async / await very easily. Regarding libraries like RxSwift or Promise, I let you refer to their different documentations since each of them will have a different implementation.</p><h2 id=the-functioning-of-a-delegate class="relative group">The functioning of a delegate <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-functioning-of-a-delegate aria-label=Anchor>#</a></span></h2><p>If you are already familiar with this concept, I invite you to go to the next chapter. If you are not, or if you want to review a bit, please stay here.</p><p>The delegate is a pattern heavily used by Apple in the core APIs of <mark>UIKit</mark>. Of course you will find it in many other languages / technologies.</p><p>The principle is quite simple: an object A performing a processing will notify an object B inheriting from a protocol C of the end of an action or the need to provide information.</p><p>If we want to express it in UML format, we would obtain this:</p><div class=mermaid align=center>%%{init: {'theme': 'dark', 'themeCSS': 'svg {background-color: black}'}}%%
classDiagram
ObjectA..>ObjectB
ObjectB--|>ProtocolC</div><p>The natural example you think of when you&rsquo;ve done <mark>UIKit</mark> is the <mark>UITableViewDelegate</mark> that you&rsquo;ve probably implemented dozens of times before:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MyViewController</span><span class=p>:</span> <span class=n>UIViewController</span><span class=p>,</span> <span class=n>UITableViewDelegate</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>tableView</span><span class=p>(</span><span class=n>UITableView</span><span class=p>,</span> <span class=n>viewForHeaderInSection</span><span class=p>:</span> <span class=nb>Int</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=n>UIView</span><span class=p>?</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this case, each time the tableView needs the view of a section, it will ask the delegate for this information. Here we are not talking about asynchronism via the delegate at all but only about delegating a decision making.</p><p>We have the case of asynchronism with the <mark>UIImagePickerControllerDelegate</mark> which asks for the implementation of the <mark>didFinishPickingMediaWithInfo</mark> method which will be called when the user has made his selection, the latter may arrive any time in the future.</p><h2 id=the-case-of-closures class="relative group">The case of closures <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-case-of-closures aria-label=Anchor>#</a></span></h2><p>The closure allows to define code with or without parameters that will be executed later. For example when the user login is successful:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>login</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>closure</span><span class=p>:</span> <span class=p>@</span><span class=n>escaping</span> <span class=p>(</span><span class=kc>_</span> <span class=n>error</span><span class=p>:</span> <span class=n>Error</span><span class=p>?)</span> <span class=p>-&gt;</span> <span class=nb>Void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MyServer</span><span class=p>.</span><span class=n>connect</span><span class=p>(</span><span class=n>with</span><span class=p>:</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=n>password</span><span class=p>)</span> <span class=p>{</span> <span class=n>error</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>        <span class=n>closure</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>@IBAction</span> <span class=kd>func</span> <span class=nf>loginButtonPressed</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>username</span> <span class=p>=</span> <span class=s>&#34;MyUsername&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>password</span> <span class=p>=</span> <span class=s>&#34;MyPassword&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kc>self</span><span class=p>.</span><span class=n>login</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=n>password</span><span class=p>)</span> <span class=p>{</span> <span class=p>[</span><span class=kr>weak</span> <span class=kc>self</span><span class=p>]</span> <span class=n>error</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>        <span class=kc>self</span><span class=p>?.</span><span class=n>loader</span><span class=p>.</span><span class=n>dismiss</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=kd>let</span> <span class=nv>error</span> <span class=p>=</span> <span class=n>error</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=kc>self</span><span class=p>?.</span><span class=n>displayError</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kc>self</span><span class=p>?.</span><span class=n>navigateToMenu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this case the closure is used to perform a UI processing when the login is completed successfully or not. The login is dependent on an API request that can take several seconds to transit, so we are in the case of asynchronism.</p><p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="exclamation-triangle" class="svg-inline--fa fa-exclamation-triangle fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></svg></span></span><span class=dark:text-neutral-300>If you do not know the usefulness of <mark>[weak self]</mark> I invite you to read the present article <a href=https://kelvas09.github.io/blog/posts/ios_weak_unowned/>here</a>.</span></div><br><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="exclamation-triangle" class="svg-inline--fa fa-exclamation-triangle fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></svg></span></span><span class=dark:text-neutral-300>If you want more information about the keyword <mark>@escaping</mark>, I invite you to read the present article <a href=https://kelvas09.github.io/blog/posts/ios-escaping/>here</a>.</span></div></p><h2 id=the-tools-provided-by-apple class="relative group">The tools provided by Apple <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-tools-provided-by-apple aria-label=Anchor>#</a></span></h2><p>Of course Apple has thought of everything and provided us with tools to convert a delegate or a closure to the async / await pattern. So be careful, when I talk about tools, I&rsquo;m not talking about an application that will take care of the code for you but a new API:</p><p><mark>withCheckedContinuation</mark> and <mark>withCheckedThrowingContinuation</mark> methods to accomplish this mission:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>withCheckedContinuation</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>    <span class=n>function</span><span class=p>:</span> <span class=nb>String</span> <span class=p>=</span> <span class=kc>#function</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kc>_</span> <span class=n>body</span><span class=p>:</span> <span class=p>(</span><span class=n>CheckedContinuation</span><span class=p>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Never</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=nb>Void</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=n>async</span> <span class=p>-&gt;</span> <span class=n>T</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>withCheckedThrowingContinuation</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>    <span class=n>function</span><span class=p>:</span> <span class=nb>String</span> <span class=p>=</span> <span class=kc>#function</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kc>_</span> <span class=n>body</span><span class=p>:</span> <span class=p>(</span><span class=n>CheckedContinuation</span><span class=p>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Error</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=nb>Void</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=n>async</span> <span class=kr>throws</span> <span class=p>-&gt;</span> <span class=n>T</span>
</span></span></code></pre></div><p>By analyzing the previous statements you will have understood that the first one does not handle errors while the second one does. Let&rsquo;s see now how to use them.</p><h2 id=proof-by-example class="relative group">Proof by example <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#proof-by-example aria-label=Anchor>#</a></span></h2><h3 id=with-a-closure class="relative group">With a closure <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#with-a-closure aria-label=Anchor>#</a></span></h3><p>The first advice I can give you is not to replace the existing method with closure by a unique method with async / await but to create an extension.</p><p>Let&rsquo;s go back to our example of the user connection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Authenticator</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>login</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>closure</span><span class=p>:</span> <span class=p>@</span><span class=n>escaping</span> <span class=p>(</span><span class=kc>_</span> <span class=n>error</span><span class=p>:</span> <span class=n>Error</span><span class=p>?)</span> <span class=p>-&gt;</span> <span class=nb>Void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>MyServer</span><span class=p>.</span><span class=n>connect</span><span class=p>(</span><span class=n>with</span><span class=p>:</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=n>password</span><span class=p>)</span> <span class=p>{</span> <span class=n>error</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>            <span class=n>closure</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>extension</span> <span class=nc>Authenticator</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>loginAsync</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=nb>String</span><span class=p>)</span> <span class=n>async</span> <span class=kr>throws</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=n>await</span> <span class=n>withCheckedThrowingContinuation</span><span class=p>({</span> <span class=p>(</span><span class=n>continuation</span><span class=p>:</span> <span class=n>CheckedContinuation</span><span class=p>&lt;</span><span class=nb>Void</span><span class=p>,</span> <span class=n>Error</span><span class=p>&gt;)</span> <span class=p>-&gt;</span> <span class=nb>Void</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>            <span class=n>login</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=n>password</span><span class=p>)</span> <span class=p>{</span> <span class=n>error</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=kd>let</span> <span class=nv>error</span> <span class=p>=</span> <span class=n>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>continuation</span><span class=p>.</span><span class=n>resume</span><span class=p>(</span><span class=n>throwing</span><span class=p>:</span> <span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>continuation</span><span class=p>.</span><span class=n>resume</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This way you can use both. In the case of async / await it will be possible to use it in the following way:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=n>await</span> <span class=n>Authenticator</span><span class=p>().</span><span class=n>loginAsync</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=s>&#34;myUsername&#34;</span><span class=p>,</span> <span class=n>password</span><span class=p>:</span> <span class=s>&#34;myPassword&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=bp>print</span><span class=p>(</span><span class=s>&#34;An error occurred: </span><span class=si>\(</span><span class=n>error</span><span class=si>)</span><span class=s>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It is much more elegant and above all you have now the possibility to use one shape or the other according to your projects and your desire!</p><h3 id=with-a-delegate class="relative group">With a delegate <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#with-a-delegate aria-label=Anchor>#</a></span></h3><p>In the case of the delegate it is a little more complicated. It is necessary to encapsulate the delegate in a class and especially to manage the <mark>Continuation</mark> object well because according to the documentation, this one can be used only <a href=https://developer.apple.com/documentation/swift/checkedcontinuation>once</a>, so it is necessary to make sure that this one is not called 2 times (or more) and is well renewed each time:</p><blockquote><p>You must call a resume method exactly once on every execution path throughout the program.</p></blockquote><p>For the next example I will take the Bluetooth LE device scan which uses the <mark>CBCentralManagerDelegate</mark> delegate to notify when a new device is found.</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="exclamation-triangle" class="svg-inline--fa fa-exclamation-triangle fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></svg></span></span><span class=dark:text-neutral-300>It is necessary to add Bluetooth capability to your project for it to work and for the user to access the permission.</span></div><p>As a reminder, our goal is simple: to allow Bluetooth LE device scanning from a simple asynchronous method and therefore without implementing the delegate and the discovery management in our view / controller.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>import</span> <span class=nc>Foundation</span>
</span></span><span class=line><span class=cl><span class=kd>import</span> <span class=nc>CoreBluetooth</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>struct</span> <span class=nc>BluetoothLEDevice</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>identifier</span><span class=p>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>name</span><span class=p>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>init</span><span class=p>(</span><span class=n>peripheral</span><span class=p>:</span> <span class=n>CBPeripheral</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kc>self</span><span class=p>.</span><span class=n>identifier</span> <span class=p>=</span> <span class=n>peripheral</span><span class=p>.</span><span class=n>identifier</span><span class=p>.</span><span class=n>uuidString</span>
</span></span><span class=line><span class=cl>        <span class=kc>self</span><span class=p>.</span><span class=n>name</span> <span class=p>=</span> <span class=n>peripheral</span><span class=p>.</span><span class=n>name</span> <span class=p>??</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>actor</span> <span class=n>BluetoothLEScanWrapper</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>enum</span> <span class=nc>BluetoothLEScanError</span><span class=p>:</span> <span class=n>Error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=n>bluetoothNotAvailable</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>let</span> <span class=nv>bluetoothLEDelegate</span><span class=p>:</span> <span class=n>BluetoothLEDelegate</span> <span class=p>=</span> <span class=n>BluetoothLEDelegate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>var</span> <span class=nv>activeTask</span><span class=p>:</span> <span class=n>Task</span><span class=o>&lt;</span><span class=p>[</span><span class=n>BluetoothLEDevice</span><span class=p>],</span> <span class=n>Error</span><span class=p>&gt;?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>scan</span><span class=p>(</span><span class=k>for</span> <span class=n>seconds</span><span class=p>:</span> <span class=nb>Double</span> <span class=p>=</span> <span class=mf>3.0</span><span class=p>)</span> <span class=n>async</span> <span class=kr>throws</span> <span class=p>-&gt;</span> <span class=p>[</span><span class=n>BluetoothLEDevice</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=kd>let</span> <span class=nv>existingTask</span> <span class=p>=</span> <span class=n>activeTask</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>try</span> <span class=n>await</span> <span class=n>existingTask</span><span class=p>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>task</span> <span class=p>=</span> <span class=n>Task</span><span class=o>&lt;</span><span class=p>[</span><span class=n>BluetoothLEDevice</span><span class=p>],</span> <span class=n>Error</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>guard</span> <span class=n>bluetoothLEDelegate</span><span class=p>.</span><span class=n>bluetoothIsOn</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>activeTask</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=n>BluetoothLEScanError</span><span class=p>.</span><span class=n>bluetoothNotAvailable</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kc>self</span><span class=p>.</span><span class=n>bluetoothLEDelegate</span><span class=p>.</span><span class=n>central</span><span class=p>.</span><span class=n>scanForPeripherals</span><span class=p>(</span><span class=n>withServices</span><span class=p>:</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=n>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>nanoseconds</span><span class=p>:</span> <span class=p>(</span><span class=nb>UInt64</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1_000_000_000</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nv>devices</span> <span class=p>=</span> <span class=n>bluetoothLEDelegate</span><span class=p>.</span><span class=n>foundPeripheral</span><span class=p>.</span><span class=n>compactMap</span> <span class=p>{</span> <span class=n>BluetoothLEDevice</span><span class=p>(</span><span class=n>peripheral</span><span class=p>:</span> <span class=nv>$0</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>bluetoothLEDelegate</span><span class=p>.</span><span class=n>central</span><span class=p>.</span><span class=n>stopScan</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>bluetoothLEDelegate</span><span class=p>.</span><span class=n>foundPeripheral</span> <span class=p>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>activeTask</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>devices</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>activeTask</span> <span class=p>=</span> <span class=n>task</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>try</span> <span class=n>await</span> <span class=n>task</span><span class=p>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kr>final</span> <span class=kd>class</span> <span class=nc>BluetoothLEDelegate</span><span class=p>:</span> <span class=n>NSObject</span><span class=p>,</span> <span class=n>CBCentralManagerDelegate</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>central</span><span class=p>:</span> <span class=n>CBCentralManager</span> <span class=p>=</span> <span class=n>CBCentralManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nv>bluetoothIsOn</span><span class=p>:</span> <span class=nb>Bool</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nv>foundPeripheral</span><span class=p>:</span> <span class=p>[</span><span class=n>CBPeripheral</span><span class=p>]</span> <span class=p>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>override</span> <span class=kd>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kc>super</span><span class=p>.</span><span class=kd>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=kc>self</span><span class=p>.</span><span class=n>central</span><span class=p>.</span><span class=n>delegate</span> <span class=p>=</span> <span class=kc>self</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>func</span> <span class=nf>centralManagerDidUpdateState</span><span class=p>(</span><span class=kc>_</span> <span class=n>central</span><span class=p>:</span> <span class=n>CBCentralManager</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kc>self</span><span class=p>.</span><span class=n>bluetoothIsOn</span> <span class=p>=</span> <span class=n>central</span><span class=p>.</span><span class=n>state</span> <span class=p>==</span> <span class=p>.</span><span class=n>poweredOn</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>func</span> <span class=nf>centralManager</span><span class=p>(</span><span class=kc>_</span> <span class=n>central</span><span class=p>:</span> <span class=n>CBCentralManager</span><span class=p>,</span> <span class=n>didDiscover</span> <span class=n>peripheral</span><span class=p>:</span> <span class=n>CBPeripheral</span><span class=p>,</span> <span class=n>advertisementData</span><span class=p>:</span> <span class=p>[</span><span class=nb>String</span> <span class=p>:</span> <span class=nb>Any</span><span class=p>],</span> <span class=n>rssi</span> <span class=n>RSSI</span><span class=p>:</span> <span class=n>NSNumber</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>guard</span> <span class=o>!</span><span class=n>foundPeripheral</span><span class=p>.</span><span class=bp>contains</span><span class=p>(</span><span class=k>where</span><span class=p>:</span> <span class=p>{</span> <span class=nv>$0</span><span class=p>.</span><span class=n>identifier</span> <span class=p>==</span> <span class=n>peripheral</span><span class=p>.</span><span class=n>identifier</span> <span class=p>})</span> <span class=k>else</span> <span class=p>{</span> <span class=k>return</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kc>self</span><span class=p>.</span><span class=n>foundPeripheral</span><span class=p>.</span><span class=n>append</span><span class=p>(</span><span class=n>peripheral</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can now call in an asynchronous method our scan method which completely abstracts our delegate :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>devices</span> <span class=p>=</span> <span class=k>try</span> <span class=n>await</span> <span class=n>wrapper</span><span class=p>.</span><span class=n>scan</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=bp>print</span><span class=p>(</span><span class=s>&#34;Devices: &lt;</span><span class=si>\(</span><span class=n>devices</span><span class=p>.</span><span class=bp>count</span><span class=si>)</span><span class=s>&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=bp>print</span><span class=p>(</span><span class=s>&#34;An error occured: </span><span class=si>\(</span><span class=n>error</span><span class=si>)</span><span class=s>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Admit that here too it&rsquo;s much sexier!</p><p>You have probably noticed that the word <mark>class</mark> has been changed by the word <mark>actor</mark>. If you want to know more I advise you to stay around, a new article will come soon to explain the difference between a <mark>class</mark> and an <mark>actor</mark>.</p><p>I hope you enjoyed this article. If you want to know more, feel free to check out the rest of the blog or follow me on <a href=https://twitter.com/KevinSibue>Twitter</a> or on <a href=https://www.reddit.com/user/KevSib>Reddit</a>.</p><p>See you soon I hope!</p><h2 id=sources class="relative group">Sources <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sources aria-label=Anchor>#</a></span></h2><ul><li><a href=https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate>https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate</a></li><li><a href=https://developer.apple.com/documentation/uikit/uitableviewdelegate>https://developer.apple.com/documentation/uikit/uitableviewdelegate</a></li><li><a href=https://developer.apple.com/documentation/swift/withcheckedcontinuation(function:_:)>https://developer.apple.com/documentation/swift/withcheckedcontinuation(function:_:)</a></li><li><a href=https://developer.apple.com/documentation/swift/withcheckedthrowingcontinuation(function:_:)>https://developer.apple.com/documentation/swift/withcheckedthrowingcontinuation(function:_:)</a></li><li><a href=https://developer.apple.com/documentation/swift/checkedcontinuation>https://developer.apple.com/documentation/swift/checkedcontinuation</a></li></ul></div></section><footer class="pt-8 max-w-prose"><div class=flex><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt=Author src=/blog/img/Me3_hufb9ae2a0c7c225d4cf50c4497573c74a_136433_192x192_fill_q75_box_smart1.JPG><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Kévin Sibué (as Kelvas)</div><div class="text-sm text-neutral-700 dark:text-neutral-400">iOS & Android Developer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:kevin.sibue.pro@outlook.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="at" class="svg-inline--fa fa-at fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 8C118.941 8 8 118.919 8 256c0 137.059 110.919 248 248 248 48.154.0 95.342-14.14 135.408-40.223 12.005-7.815 14.625-24.288 5.552-35.372l-10.177-12.433c-7.671-9.371-21.179-11.667-31.373-5.129C325.92 429.757 291.314 440 256 440c-101.458.0-184-82.542-184-184S154.542 72 256 72c100.139.0 184 57.619 184 160 0 38.786-21.093 79.742-58.17 83.693-17.349-.454-16.91-12.857-13.476-30.024l23.433-121.11C394.653 149.75 383.308 136 368.225 136h-44.981a13.518 13.518.0 00-13.432 11.993l-.01.092c-14.697-17.901-40.448-21.775-59.971-21.775-74.58.0-137.831 62.234-137.831 151.46.0 65.303 36.785 105.87 96 105.87 26.984.0 57.369-15.637 74.991-38.333 9.522 34.104 40.613 34.103 70.71 34.103C462.609 379.41 504 307.798 504 232 504 95.653 394.023 8 256 8zm-21.68 304.43c-22.249.0-36.07-15.623-36.07-40.771.0-44.993 30.779-72.729 58.63-72.729 22.292.0 35.601 15.241 35.601 40.77.0 45.061-33.875 72.73-58.161 72.73z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://bento.me/kevin-sibue target=_blank aria-label=Link rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/Kelvas09 target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/kevin-sibue-a67417b8 target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://home.social/@kelvas target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.reddit.com/user/KevSib target=_blank aria-label=Reddit rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/KevinSibue target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></div></div></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://www.facebook.com/sharer/sharer.php?u=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/&amp;quote=Convert%20a%20closure%20or%20a%20delegate%20to%20async%20/%20await" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://twitter.com/intent/tweet/?url=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/&amp;text=Convert%20a%20closure%20or%20a%20delegate%20to%20async%20/%20await" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/&amp;description=Convert%20a%20closure%20or%20a%20delegate%20to%20async%20/%20await" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="pinterest" class="svg-inline--fa fa-pinterest fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://reddit.com/submit/?url=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/&amp;resubmit=true&amp;title=Convert%20a%20closure%20or%20a%20delegate%20to%20async%20/%20await" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/&amp;title=Convert%20a%20closure%20or%20a%20delegate%20to%20async%20/%20await" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="mailto:?body=https://kelvas09.github.io/blog/posts/closure-delegate-to-async/&amp;subject=Convert%20a%20closure%20or%20a%20delegate%20to%20async%20/%20await" title="Send via email" aria-label="Send via email"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="at" class="svg-inline--fa fa-at fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 8C118.941 8 8 118.919 8 256c0 137.059 110.919 248 248 248 48.154.0 95.342-14.14 135.408-40.223 12.005-7.815 14.625-24.288 5.552-35.372l-10.177-12.433c-7.671-9.371-21.179-11.667-31.373-5.129C325.92 429.757 291.314 440 256 440c-101.458.0-184-82.542-184-184S154.542 72 256 72c100.139.0 184 57.619 184 160 0 38.786-21.093 79.742-58.17 83.693-17.349-.454-16.91-12.857-13.476-30.024l23.433-121.11C394.653 149.75 383.308 136 368.225 136h-44.981a13.518 13.518.0 00-13.432 11.993l-.01.092c-14.697-17.901-40.448-21.775-59.971-21.775-74.58.0-137.831 62.234-137.831 151.46.0 65.303 36.785 105.87 96 105.87 26.984.0 57.369-15.637 74.991-38.333 9.522 34.104 40.613 34.103 70.71 34.103C462.609 379.41 504 307.798 504 232 504 95.653 394.023 8 256 8zm-21.68 304.43c-22.249.0-36.07-15.623-36.07-40.771.0-44.993 30.779-72.729 58.63-72.729 22.292.0 35.601 15.241 35.601 40.77.0 45.061-33.875 72.73-58.161 72.73z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/blog/posts/assert-precondition-fatalerror/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">assert, precondition and fatalError</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-07-16 00:00:00 +0000 UTC">16 July 2022</time></span></span></a></span>
<span><a class="flex text-right group" href=/blog/posts/new-language/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">A new language is available! 🇫🇷</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-03-11 00:00:00 +0000 UTC">11 March 2023</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://kelvas09.github.io/blog/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentcolor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19.0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48.0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48.0L9.21 111.45c-12.28 12.28-12.28 32.19.0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19.0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48.0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48.0l22.24-22.24c12.28-12.28 12.28-32.19.0-44.48L242.72 256z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div><footer class=py-10><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Kévin Sibué (as Kelvas)</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M283.211 512c78.962.0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954.0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156.0 00283.211.0c-141.309.0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 160c-52.9.0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6.0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0s-49.9-131.1.0-181 131.1-49.9 181 0 49.9 131.1.0 181z"/></svg></span></span></button></div></div></footer></body></html>